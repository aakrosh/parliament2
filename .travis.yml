sudo: required

services:
  - docker

env:
  SHORT_COMMIT=`echo $TRAVIS_COMMIT | cut -c1-7`
  CURRENT_DATE=`date '+%Y%m%d%H%M%S'`
  TAG="${CURRENT_DATE}_${SHORT_COMMIT}"
  PATH=/snap/bin:$PATH

before_install:
  - sudo apt-get update && sudo apt-get install --only-upgrade openssl
  - sudo pip install --user urllib3[secure] --upgrade
  - tar -czf resources.tar.gz resources/
  - docker build -t dnanexus/parliament2:$TAG .
  - docker tag dnanexus/parliament2:$TAG dnanexus/parliament2

jobs:
  include:
    - script: docker run dnanexus/parliament2:$TAG -q -h
    - script: sudo bash test_scripts/breakdancer_test.sh
    - script: sudo bash test_scripts/breakseq_test.sh
    - script: sudo bash test_scripts/cnvnator_test.sh
    - script: sudo bash test_scripts/delly_deletion_test.sh
    - script: sudo bash test_scripts/delly_duplication_test.sh
    - script: sudo bash test_scripts/delly_insertion_test.sh
    - script: sudo bash test_scripts/delly_inversion_test.sh
    - script: sudo bash test_scripts/lumpy_test.sh
    - script: sudo bash test_scripts/manta_test.sh
    - script: sudo bash test_scripts/svviz_test.sh
    - script: sudo bash test_scripts/full_small_test.sh

branches:
  except:
  - hgsc

language: python
python: 
  - "2.7.13"